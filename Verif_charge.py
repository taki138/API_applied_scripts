import requests
import datetime
import time
from dateutil.parser import parse
import json
import csv


def Konnective_verif_charge(customerId, cardType):
	if cardType.endswith('MASTERCARD'):
		product1_id = '1209'
	else:
		product1_id = '1210'
	loginId = 'loginK'
	password = 'Konnektive2017'
	paySource = 'ACCTONFILE'
	campaignId = '61'
	product1_qty = '1'
	urlQueryTransactions = 'https://api.konnektive.com/order/import/?campaignId=' + \
						   str(campaignId) + \
						   '&product1_qty=' + \
						   str(product1_qty) + \
						   '&product1_id=' + \
						   product1_id + \
						   '&loginId=' + \
						   loginId + \
						   '&password=' + \
						   password + \
						   '&customerId=' + \
						   str(customerId) + \
						   '&paySource=' + \
						   paySource
	try:
		r = requests.post(urlQueryTransactions)
		parseResponse = r.json()
	except:
		parseResponse['result'] = 'ERROR'
	if parseResponse['result'] == 'ERROR':
		ResultWriter = customerId, parseResponse['result'], parseResponse['message']
	else:
		emailAddress = parseResponse['message']['emailAddress']
		ResultWriter = customerId, emailAddress, 'SUCCESS'
	print(ResultWriter)


inputFilename = "get trxs.csv"
inputFilePath = "C:\\Users\\1\\Downloads\\"
with open(inputFilePath + inputFilename, "r", encoding="latin-1") as f:
	lst = csv.reader(f, delimiter=',')
	for line in lst:
		startDateRaw = line[0]
		customerId = line[1]
		startDate = datetime.datetime.strptime(startDateRaw, "%m/%d/%Y %H:%M")
		startDate1 = (startDate - datetime.timedelta(days=1)).strftime("%#m/%#d/%y")
		endDate = (startDate + datetime.timedelta(days=1)).strftime("%#m/%#d/%y")
		startTime = '00:00'
		endTime = '23:59'
		loginId = 'loginK'
		password = 'Konnektive2017'
		responseType = 'SUCCESS'
		urlQueryTransactions = 'https://api.konnektive.com/transactions/query/?startDate=' + \
							   str(startDate1) + \
							   '&endDate=' + \
							   str(endDate) + \
							   '&responseType=' + \
							   responseType + \
							   '&loginId=' + \
							   loginId + \
							   '&password=' + \
							   password + \
							   '&customerId=' + \
							   str(customerId)
		r = requests.post(urlQueryTransactions)
		parseResponse = r.json()
		if parseResponse['result'] == 'ERROR':
			print(customerId, parseResponse['result'], parseResponse['message'])
		else:
			cardBin = parseResponse['message']['data'][0]['cardBin']
			transactionId = parseResponse['message']['data'][0]['transactionId']
			emailAddress = parseResponse['message']['data'][0]['emailAddress']
			cardType = parseResponse['message']['data'][0]['cardType']
			customerId = parseResponse['message']['data'][0]['customerId']
			BinList = [
				'497783',
				'513101',
				'513162',
				'513263',
				'513272',
				'513283',
				'513641',
				'513647',
				'513690',
				'513773',
				'534102',
				'553979',
				'513770',
				'513130',
				'513141',
				'513184',
				'534104',
				'513186',
				'534101',
				'513142',
				'513772',
				'544780',
				'483497',
				'513379',
				'513517',
				'513621',
				'513531',
				'513608',
				'513518',
				'513279',
				'513238',
				'513623',
				'513646',
				'513640',
				'513668',
				'537964',
				'554965',
				'513296',
				'513734',
				'529434',
				'513277',
				'536568',
				'513024',
				'513861',
				'513625',
				'513023',
				'542718',
				'403054',
				'516176',
				'414083',
				'414087',
				'421127',
				'405725',
				'437861',
				'544747',
				'548165',
				'516118',
				'516492',
				'517066',
				'531936',
				'497043',
				'497607',
				'497887',
				'497041',
				'497814',
				'497874',
				'497074',
				'497886',
				'497427',
				'497546',
				'497804',
				'497943',
				'497864',
				'497562',
				'497567',
				'497856',
				'497946',
				'497739',
				'497598',
				'497355',
				'497600',
				'497836',
				'497203',
				'497606',
				'497573',
				'497587',
				'497040',
				'497049',
				'497237',
				'497762',
				'497538',
				'513286',
				'500000',
				'610000',
				'630000',
				'660000',
				'340000',
				'370000',
				'601100',
				'640000',
				'652200',
				'352800',
				'360000',
				'300000',
				'309500',
				'380000',
				'502000',
				'501900',
				'627000',
				'604000',
				'405621',
				'419704',
				'425125',
				'434005',
				'476665',
				'487474',
				'489788',
				'493592',
				'497401',
				'497402',
				'497490',
				'497641',
				'402360',
				'533317',
				'490117',
				'510021',
				'513659',
				'539976',
				'540659',
				'530826',
				'550018',
				'434960',
				'495000',
				'495034',
				'510197',
				'550020',
				'535583',
				'522660',
				'522661',
				'479696',
				'516815',
				'554501',
				'543560',
				'534534',
				'410651',
				'477124',
				'492556',
				'457115',
				'457133',
				'457139',
				'457147',
				'457149',
				'457135',
				'457136',
				'457143',
				'535939',
				'547132',
				'547133',
				'557384',
				'404793',
				'540448',
				'495083',
				'476326',
				'548659',
				'462722',
				'526750',
				'540058',
				'534232',
				'536414',
				'492536',
				'545478',
				'492557',
				'456997',
				'431310',
				'453903',
				'535570',
				'403027',
				'533870',
				'548398',
				'403035',
				'487716',
				'520956',
				'457144',
				'549774',
				'534207',
				'530514',
				'437863',
				'408443',
				'535476',
				'516795',
				'402361',
				'539832',
				'524694',
				'526743',
				'434994',
				'487710',
				'535921',
				'534924',
				'494331',
				'531158',
				'517053',
				'483843',
				'543409',
				'529948',
				'497410',
				'540028',
				'512688',
				'529097',
				'453904',
				'547988',
				'513163',
				'560000',
				'561260',
				'561259',
				'497831',
				'513029',
				'457102',
				'457130',
				'457132',
				'457134',
				'457138',
				'457140',
				'457141',
				'457146',
				'457148',
				'545996',
				'558441',
				'477123',
				'561243',
				'561244',
				'479694',
				'517008',
				'517009',
				'517023',
				'548719',
				'510199',
				'402730',
				'490118',
				'530772',
				'469279',
				'557385',
				'406170',
				'429941',
				'497711',
				'497756',
				'497778',
				'497784',
				'513239',
				'513275',
				'513606',
				'513616',
				'513644',
				'513648',
				'513737',
				'513742',
				'513758',
				'529483',
				'529556',
				'539960',
				'513234',
				'513284',
				'513854',
				'529314',
				'497709',
				'497710',
				'497777',
				'513607',
				'513632',
				'513666',
				'513736',
				'513856',
				'529456',
				'497707',
				'497754',
				'513614',
				'513738',
				'513601',
				'513604',
				'497967',
				'513636',
				'497798',
				'513309',
				'546958',
				'497712',
				'513642',
				'533019',
				'513297',
				'513657',
				'513705',
				'521313',
				'513711',
				'529542',
				'497796',
				'529313',
				'513250',
				'513612',
				'497799',
				'520604',
				'513365',
				'513735',
				'513743',
				'497753',
				'513273',
				'513605',
				'529484',
				'513248',
				'513706',
				'456295',
				'456299',
				'497601',
				'497602',
				'497604',
				'497608',
				'497623',
				'497624',
				'497657',
				'497940',
				'513740',
				'497652',
				'497656',
				'497235',
				'497658',
				'497659',
				'497947',
				'459331',
				'497941',
				'497948',
				'497988',
				'497992',
				'497685',
				'497944',
				'497612',
				'513225',
				'497636',
				'497616',
				'497706',
				'497952',
				'513660',
				'497634',
				'497986',
				'550138',
				'457197',
				'457121',
				'457154',
				'457181',
				'517014',
				'550021',
				'431431',
				'540444',
				'540948',
				'550022',
				'405911',
				'419372',
				'510022',
				'419374',
				'465968',
				'443612',
				'550140',
				'443592',
				'495018',
				'540445',
				'533292',
				'454713',
				'404240',
				'457114',
				'510020',
				'515859',
				'422165',
				'427723',
				'434983',
				'453755',
				'457241',
				'458109',
				'490929',
				'475129',
				'534643',
				'534243',
				'535296',
				'516020',
				'518620',
				'520991',
				'537461',
				'541256',
				'544481',
				'557447',
				'535584',
				'548696',
				'454469',
				'459654',
				'474503',
				'512759',
				'528838',
				'535463',
				'539152',
				'434499',
				'474843',
				'490762',
				'493000',
				'499897',
				'516746',
				'523252',
				'523253',
				'523254',
				'523255',
				'523256',
				'528836',
				'529952',
				'529953',
				'549001',
				'549701',
				'549710',
				'497932',
				'497301',
				'456140',
				'499001',
				'456188',
				'456239',
				'497653',
				'513380',
				'553899',
				'456221',
				'456230',
				'497568',
				'497599',
				'456240',
				'456250',
				'540205',
				'453304',
				'453307',
				'401030',
				'453314',
				'453352',
				'453397',
				'456122',
				'456126',
				'456201',
				'456216',
				'456233',
				'456263',
				'497115',
				'497146',
				'497202',
				'497278',
				'497291',
				'497408',
				'497422',
				'497464',
				'497500',
				'497518',
				'497542',
				'497547',
				'497566',
				'497592',
				'497827',
				'497841',
				'497862',
				'513108',
				'513536',
				'513781',
				'516281',
				'529928',
				'561257',
				'533389',
				'400288',
				'405208',
				'416493',
				'417311',
				'416985',
				'445035',
				'479674',
				'417473',
				'427238',
				'431083',
				'439516',
				'441266',
				'492560',
				'492562',
				'492565',
				'494656',
				'512083',
				'535179',
				'540481',
				'541063',
				'492561',
				'526948',
				'540123',
				'540185',
				'541306',
				'535586',
				'467021',
				'548904',
				'556671',
				'402341',
				'453973',
				'554014',
				'549928',
				'404386',
				'515878',
				'535120',
				'521566',
				'403541',
				'456071',
				'450827',
				'485720',
				'510087',
				'450625',
				'454496',
				'422239',
				'459990',
				'491847',
				'554506',
				'546409',
				'454859',
				'544958',
				'494019',
				'553108',
				'531822',
				'454663',
				'554001',
				'534283',
				'530482',
				'553997',
				'424586',
				'510034',
				'491850',
				'456012',
				'406743',
				'410628',
				'402294',
				'436113',
				'554040',
				'540209',
				'455246',
				'541542',
				'427278',
				'455252',
				'426221',
				'457248',
				'535876',
				'440707',
				'404856',
				'549821',
				'554080',
				'405200',
				'440281',
				'455276',
				'554070',
				'543877',
				'552894',
				'525638',
				'554058',
				'558435',
				'436699',
				'522754',
				'558554',
				'409017',
				'412568',
				'425566',
				'436194',
				'440283',
				'453974',
				'459560',
				'480224',
				'433967',
				'436669',
				'440709',
				'483657',
				'494038',
				'537434',
				'552145',
				'556021',
				'434388',
				'466271',
				'418811',
				'459979',
				'512482',
				'550584',
				'483651',
				'492121',
				'510017',
				'532017',
				'547978',
				'406308',
				'410667',
				'415005',
				'454339',
				'459999',
				'417682',
				'436195',
				'496632',
				'496642',
				'528093',
				'540232',
				'404102',
				'430504',
				'440280',
				'455715',
				'493738',
				'494014',
				'496627',
				'524722',
				'554618',
				'403642',
				'413227',
				'415936',
				'416240',
				'427784',
				'429481',
				'435658',
				'450922',
				'459961',
				'483676',
				'483681',
				'494015',
				'523921',
				'545659',
				'547863',
				'547876',
				'403519',
				'403888',
				'410641',
				'450703',
				'459983',
				'526159',
				'526389',
				'499977',
				'541106',
				'428455',
				'415934',
				'421473',
				'455642',
				'459995',
				'480135',
				'512299',
				'540246',
				'541708',
				'554068',
				'558781',
				'401836',
				'402027',
				'402342',
				'404700',
				'406036',
				'409019',
				'415003',
				'421101',
				'513775',
				'523718',
				'457124',
				'416364',
				'402400',
				'553389',
				'527346',
				'416028',
				'548281',
				'535928',
				'542763',
				'535518',
				'483054',
				'533003',
				'516109',
				'447149',
				'457662',
				'543785',
				'405245',
				'457126',
				'589973',
				'589974',
				'513414',
				'462723',
				'550026',
				'526685',
				'526624',
				'526695',
				'526625',
				'526694',
				'526683',
				'526623',
				'526627',
				'443877',
				'410364',
				'447596',
				'420804',
				'491782',
				'549703',
				'549706',
				'549006',
				'549004',
				'517021',
				'402620',
				'457122',
				'457131',
				'457177',
				'497208',
				'513771',
				'513173',
				'513780',
				'513138',
				'497993',
				'517011',
				'517013',
				'517025',
				'517033',
				'517036',
				'457120',
				'520970',
				'520974',
				'526333',
				'541398',
				'556000',
				'457155',
				'525412',
				'477101',
				'497678',
				'497696',
				'453342',
				'456273',
				'469805',
				'497030',
				'497456',
				'497664',
				'497048',
				'456274',
				'497152',
				'535612',
				'513267',
				'529470',
				'535611',
				'536115',
				'456225',
				'472686',
				'517365',
				'535590',
				'558515',
				'431086',
				'431313',
				'437837',
				'406577',
				'434812',
				'525306',
				'410652',
				'526792',
				'516026',
				'522837',
				'516936',
				'531195',
				'513165',
				'497678',
				'497696',
				'453342',
				'456273',
				'469805',
				'497030',
				'497456',
				'497664',
				'497048',
				'456274',
				'497152',
				'535612',
				'513267',
				'529470',
				'535611',
				'536115',
				'456225',
				'472686',
				'517365',
				'535590',
				'558515',
				'431086',
				'431313',
				'437837',
				'406577',
				'434812',
				'525306',
				'410652',
				'526792',
				'516026',
				'522837',
				'516936',
				'531195',
				'513165',
				'513165',
				'424397',
				'432467',
				'479695',
				'524828',
				'535329',
				'431870',
				'431871',
				'432277',
				'542986',
				'432466',
				'492040',
				'527591',
				'527593',
				'405912',
				'435379',
				'467297',
				'492113',
				'546887',
				'555951',
				'424942',
				'492010',
				'522841',
				'525755',
				'413483',
				'453905',
				'491889',
				'521358',
				'527502',
				'528248',
				'529936',
				'534244',
				'540154',
				'544902',
				'548946',
				'458166',
				'524437',
				'534532',
				'427280',
				'434696',
				'492564',
				'414904',
				'414915',
				'414916',
				'428258',
				'432110',
				'436338',
				'438320',
				'455578',
				'456354',
				'456874',
				'490843',
				'516008',
				'516875',
				'520953',
				'521965',
				'524886',
				'530100',
				'544888',
				'546058',
				'557524',
				'492563',
				'406336',
				'431363',
				'441026',
				'457153',
				'457193',
				'457176',
				'457137',
				'406438',
				'457101',
				'457168',
				'457190',
				'457119',
				'457142',
				'557450',
				'543073',
				'432271',
				'513358',
				'545094',
				'543321',
				'457150',
				'457171',
				'457172',
				'457174',
				'457178',
				'457179',
				'457191',
				'457192',
				'457196',
				'420773',
				'427279',
				'517006',
				'457123',
				'521841',
				'530804',
				'540490',
				'434735',
				'434961',
				'457104',
				'541582',
				'541648',
				'557892',
				'400192',
				'400216',
				'402960',
				'459390',
				'419375',
				'419373',
				'431430',
				'443593',
				'466274',
				'476314',
				'495075',
				'523514',
				'529946',
				'549863',
				'558265',
				'453337',
				'497424',
				'513260',
				'525442',
				'543065',
				'414283',
				'416515',
				'431312',
				'539155',
				'521835',
				'492578',
				'457108',
				'517012',
				'404264',
				'422093',
				'422211',
				'427313',
				'490473',
				'544271',
				'544990',
				'414720',
				'414734',
				'416046',
				'406498',
				'424631',
				'424840',
				'422676',
				'403446',
				'423223',
				'426684',
				'426752',
				'435880',
				'440066',
				'440393',
				'442062',
				'451431',
				'478499',
				'481582',
				'483493',
				'484718',
				'494160',
				'517800',
				'457106',
				'457113',
				'457125',
				'510149',
				'403015',
				'403995',
				'407535',
				'424002',
				'468271',
				'485246',
				'485340',
				'414398',
				'473702',
				'434256',
				'425808',
				'511361',
				'511317',
				'511565',
				'516488',
				'531108',
				'544895',
				'416257',
				'431316',
				'431362',
				'492007',
				'424398',
				'535685',
				'535686',
				'543315',
				'513111',
				'513777',
				'434697',
				'477268',
				'411002',
				'415056',
				'456144',
				'457737',
				'531422',
				'497329',
				'497650',
				'536563',
				'402150',
				'443913',
				'549138',
				'465967',
				'404702',
				'447882',
				'451161',
				'538734',
				'541472',
				'542809',
				'547427',
				'550137',
				'550141',
				'408635',
				'421402',
				'421973',
				'440847',
				'451901',
				'451903',
				'453600',
				'454002',
				'454003',
				'455121',
				'511340',
				'520990',
				'533621',
				'533814',
				'531935',
				'543034',
				'466288',
				'483058',
				'517376',
				'520680',
				'521823',
				'535198',
				'539851',
				'418762',
				'428692',
				'403003',
				'416363',
				'416365',
				'417631',
				'272099',
				'537541',
				'453997',
				'415059',
				'560253',
				'561242',
				'560254',
				'524879',
				'499913',
				'499916',
				'537972',
				'400277',
				'431314',
				'431315',
				'445037',
				'528257',
				'532833',
				'549526',
				'538704',
				'410489',
				'414397',
				'414740',
				'416995',
				'419002',
				'434257',
				'434769',
				'437303',
				'438857',
				'441103',
				'441712',
				'442644',
				'442657',
				'442787',
				'443040',
				'443041',
				'443044',
				'443045',
				'443051',
				'443264',
				'444796',
				'446542',
				'447404',
				'447972',
				'451440',
				'461046',
				'464018',
				'464733',
				'472962',
				'472777',
				'473622',
				'474478',
				'474488',
				'474665',
				'475055',
				'475465',
				'476165',
				'480213',
				'481583',
				'483312',
				'483950',
				'511165',
				'552433',
				'546540',
				'521853',
				'521333',
				'517805',
				'514377',
				'511933',
				'554985',
				'483741',
				'524651',
				'540223',
				'499011',
				'403833',
				'403905',
				'405544',
				'407166',
				'407941',
				'411773',
				'424068',
				'426428',
				'434258',
				'558158',
				'448233',
				'523914',
				'546616',
				'406095',
				'443047',
				'400022',
				'407571',
				'473104',
				'489433',
				'455679',
				'530446',
				'513028',
				'435378',
				'492013',
				'535445',
				'550139',
				'519612',
				'464556',
				'491850',
				'510133',
				'528497',
				'404386',
				'528061',
				'453081',
				'456282',
				'499033',
				'456235',
				'497519',
				'497563',
				'497164',
				'513513',
				'536107',
				'554477',
				'439515',
				'535600',
				'540022',
				'483561',
				'450644',
				'472409',
				'408089',
				'453308',
				'513778',
				'453356',
				'513415',
				'513782',
				'453315',
				'513774',
				'453332',
				'453341',
				'453359',
				'513151',
				'535029',
				'453338',
				'513137',
				'513303',
				'534109',
				'549538',
				'457896',
				'581783',
				'581750',
				'581797',
				'585482',
				'585483',
				'589972',
				'465859',
				'415159',
				'536618',
				'436773',
				'446291',
				'446238',
				'462239',
				'521729',
				'536496',
				'465858',
				'518176',
				'460332',
				'489445',
				'449744',
				'450407',
				'454616',
				'401093',
				'530696',
				'498534',
				'539828',
				'454322',
				'424114',
				'540019',
				'526808',
				'526430',
				'423077',
				'525610',
				'416334',
			]

		if cardBin in BinList:
			print(customerId, transactionId, cardBin, emailAddress, cardType, 'Have BIN-Mapping')
		else:
			Konnective_verif_charge(customerId, cardType)
